#!/usr/bin/env python3
# This file is placed in the Public Domain.


"daemon"


import getpass
import os
import sys


sys.path.insert(0, os.getcwd())


from otp.face import Client, Config, Event
from otp.face import banner, command, errors, daemon, forever, modnames
from otp.face import parse, pidfile, privileges, scanner, wrap


if os.path.exists('mods'):
    from mods import face as MODS
else:
    MODS = None


def main():
    "main"
    parse(Config, " ".join(sys.argv[1:]))
    Config.mod = ",".join(modnames(MODS))
    Config.user = getpass.getuser()
    daemon()
    privileges(Config.user)
    pidfile(Config.pidfile)
    for mod in scanner(Config.mod, MODS):
        if "init" in dir(mod):
            mod.init()
    forever()


if __name__ == "__main__":
    wrap(main, print)
    errors(print)
